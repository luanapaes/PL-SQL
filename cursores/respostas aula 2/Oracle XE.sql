-- Apagar tabelas caso já existam (opcional)
DROP TABLE empregados CASCADE CONSTRAINTS;
DROP TABLE departamentos CASCADE CONSTRAINTS;

-- Tabela de Departamentos
CREATE TABLE departamentos (
  id              NUMBER(4)       PRIMARY KEY,
  nome            VARCHAR2(50)    NOT NULL
);

-- Tabela de Empregados
CREATE TABLE empregados (
  id              NUMBER(6)       PRIMARY KEY,
  nome            VARCHAR2(100)   NOT NULL,
  cargo           VARCHAR2(50),
  salario         NUMBER(10,2),
  departamento_id NUMBER(4),
  CONSTRAINT fk_emp_depto FOREIGN KEY (departamento_id)
    REFERENCES departamentos (id)
);

CREATE SEQUENCE seq_empregados
  START WITH 1
  INCREMENT BY 1
  NOCACHE;

INSERT INTO departamentos (id, nome) VALUES (10, 'Recursos Humanos');
INSERT INTO departamentos (id, nome) VALUES (20, 'Vendas');
INSERT INTO departamentos (id, nome) VALUES (30, 'TI');
INSERT INTO departamentos (id, nome) VALUES (40, 'Financeiro');
COMMIT;

INSERT INTO empregados (id, nome, cargo, salario, departamento_id)
VALUES (seq_empregados.NEXTVAL, 'Ana Souza', 'Analista de RH', 2500, 10);

INSERT INTO empregados (id, nome, cargo, salario, departamento_id)
VALUES (seq_empregados.NEXTVAL, 'Carlos Pereira', 'Gerente de Vendas', 4800, 20);

INSERT INTO empregados (id, nome, cargo, salario, departamento_id)
VALUES (seq_empregados.NEXTVAL, 'Fernanda Lima', 'Vendedora', 1800, 20);

INSERT INTO empregados (id, nome, cargo, salario, departamento_id)
VALUES (seq_empregados.NEXTVAL, 'João Oliveira', 'Programador', 2200, 30);

INSERT INTO empregados (id, nome, cargo, salario, departamento_id)
VALUES (seq_empregados.NEXTVAL, 'Marcos Dias', 'DBA', 3500, 30);

INSERT INTO empregados (id, nome, cargo, salario, departamento_id)
VALUES (seq_empregados.NEXTVAL, 'Patrícia Santos', 'Contadora', 2700, 40);

INSERT INTO empregados (id, nome, cargo, salario, departamento_id)
VALUES (seq_empregados.NEXTVAL, 'Rafael Souza', 'Estagiário', 950, 30);

INSERT INTO empregados (id, nome, cargo, salario, departamento_id)
VALUES (seq_empregados.NEXTVAL, 'Bianca Costa', 'Auxiliar Adm.', 1200, 10);

COMMIT;

CREATE TABLE clientes (
    id_cliente NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    nome       VARCHAR2(100),
    cidade     VARCHAR2(50),
    data_nasc  DATE
);

INSERT INTO clientes (nome, cidade, data_nasc) VALUES ('João Silva', 'São Paulo', DATE '1985-02-15');
INSERT INTO clientes (nome, cidade, data_nasc) VALUES ('Maria Oliveira', 'Curitiba', DATE '1990-07-22');
INSERT INTO clientes (nome, cidade, data_nasc) VALUES ('Carlos Souza', 'Belo Horizonte', DATE '1978-09-10');
INSERT INTO clientes (nome, cidade, data_nasc) VALUES ('Ana Santos', 'Porto Alegre', DATE '1995-12-01');
COMMIT;

CREATE TABLE funcionarios (
    id_func   NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    nome      VARCHAR2(100),
    cargo     VARCHAR2(50),
    salario   NUMBER(10,2)
);

INSERT INTO funcionarios (nome, cargo, salario) VALUES ('Paulo Almeida', 'Analista', 3500);
INSERT INTO funcionarios (nome, cargo, salario) VALUES ('Juliana Costa', 'Gerente', 7000);
INSERT INTO funcionarios (nome, cargo, salario) VALUES ('Lucas Mendes', 'Assistente', 2500);
INSERT INTO funcionarios (nome, cargo, salario) VALUES ('Fernanda Lima', 'Vendedor', 3000);
COMMIT;

CREATE TABLE pedidos (
    id_pedido   NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    id_cliente  NUMBER NOT NULL,
    data_pedido DATE DEFAULT SYSDATE,
    valor_total NUMBER(10,2),
    CONSTRAINT fk_pedido_cliente FOREIGN KEY (id_cliente) REFERENCES clientes(id_cliente)
);

INSERT INTO pedidos (id_cliente, data_pedido, valor_total) VALUES (1, SYSDATE - 10, 1500);
INSERT INTO pedidos (id_cliente, data_pedido, valor_total) VALUES (2, SYSDATE - 5, 3000);
INSERT INTO pedidos (id_cliente, data_pedido, valor_total) VALUES (2, SYSDATE - 1, 2500);
INSERT INTO pedidos (id_cliente, data_pedido, valor_total) VALUES (3, SYSDATE - 2, 500);
COMMIT;

CREATE TABLE itens_pedido (
    id_item      NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    id_pedido    NUMBER NOT NULL,
    produto      VARCHAR2(100),
    quantidade   NUMBER,
    preco_unitario NUMBER(10,2),
    CONSTRAINT fk_item_pedido FOREIGN KEY (id_pedido) REFERENCES pedidos(id_pedido)
);

INSERT INTO itens_pedido (id_pedido, produto, quantidade, preco_unitario)
VALUES (1, 'Notebook', 1, 1500);

INSERT INTO itens_pedido (id_pedido, produto, quantidade, preco_unitario)
VALUES (2, 'Smartphone', 2, 1500);

INSERT INTO itens_pedido (id_pedido, produto, quantidade, preco_unitario)
VALUES (3, 'Tablet', 1, 2500);

INSERT INTO itens_pedido (id_pedido, produto, quantidade, preco_unitario)
VALUES (4, 'Cabo HDMI', 2, 250);
COMMIT;

CREATE TABLE estoque (
    id_produto NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    nome_produto VARCHAR2(100),
    quantidade NUMBER
);

INSERT INTO estoque (nome_produto, quantidade) VALUES ('Notebook', 10);
INSERT INTO estoque (nome_produto, quantidade) VALUES ('Smartphone', 20);
INSERT INTO estoque (nome_produto, quantidade) VALUES ('Tablet', 15);
INSERT INTO estoque (nome_produto, quantidade) VALUES ('Cabo HDMI', 30);
COMMIT;

--Exercício 1 – Cursor para reajuste de salário
--Crie um bloco PL/SQL que:
-- -> Percorra a tabela empregados usando um cursor.
-- -> Aumente o salário em 5% se o salário for menor que 2000.
-- -> Exiba uma mensagem com o nome e o novo salário.

DECLARE 
    CURSOR c_emp IS 
    SELECT nome, salario
    FROM empregados;
    
    vNome empregados.nome%type;
    vSalario empregados.salario%type;
BEGIN
    OPEN c_emp;
    LOOP 
    FETCH c_emp INTO vNome, vSalario;
    EXIT WHEN c_emp%NOTFOUND;
    
    IF vSalario < 2000 then
        vSalario := vSalario + vSalario * 0.05;
        dbms_output.put_line(vNome || ' - ' || vSalario);
    ELSE 
        dbms_output.put_line('Funcionário não elegível para receber aumento.');
    END IF;
    END LOOP; 
END;